# TODO

## 1. Инициализация проекта
- [x] Создать репозиторий проекта
- [x] Инициализировать новый Git-репозиторий.
- [x] Добавить .gitignore для Go-проектов.
- [x] Настроить структуру проекта согласно архитектуре
- [x] Создать директории `cmd/`, `internal/`, `pkg/`, `configs/`, `tests/`, `scripts/`, `deploy/`, `docs/`.
- [x] Инициализировать модуль Go
- [x] Выполнить `go mod init github.com/your_username/your_project_name`.

## 2. Настройка зависимостей

- [x] Добавить необходимые библиотеки в `go.mod`
    - [x] `solana-go` для взаимодействия с блокчейном Solana.
    - [x] `gobwas/ws` для работы с WebSocket.
    - [x] `zap` для логирования.
    - [x] `spf13/cobra` для создания CLI-интерфейса.
    - [x] `spf13/viper` для управления конфигурациями.
    - [x] Любые другие необходимые библиотеки.

## 3. Реализация основных компонентов

### 3.1 `cmd/bot/main.go`

- [x] Инициализировать логгер с использованием `zap`
- [x] Обработать возможные ошибки и настроить deferred вызов `logger.Sync()`.
- [x] Загрузить конфигурацию приложения
    - [x] Реализовать функцию `LoadConfig` в пакете `config` и использовать ее в `main.go`.
- [x] Загрузить кошельки пользователя
    - [x] Реализовать функцию `LoadWallets` в пакете `wallet` и использовать ее.
- [x] Инициализировать клиент Solana
    - [x] Создать экземпляр клиента в пакете `solana` и инициализировать его в `main.go`.
- [x] Загрузить задачи для бота
    - [x] Реализовать функцию `LoadTasks` в пакете `sniping` и использовать ее.
- [x] Создать экземпляр снайпера и запустить задачи
    - [x] Создать объект `Sniper` и вызвать метод `Run` с переданными задачами.

### 3.2 `internal/config/config.go`

- [x] Реализовать функцию `LoadConfig`
    - [x] Чтение файла `config.json`.
    - [x] Парсинг JSON в структуру `Config`.
    - [x] Валидация обязательных полей.
    - [x] Обработка ошибок.
- [x] Добавить поддержку переменных окружения с использованием `viper`
    - [x] Позволить переопределять конфигурацию через переменные среды.

### 3.3 `internal/wallet/wallet.go`

- [x] Реализовать функцию `LoadWallets`
    - [x] Чтение файла `wallets.csv`.
    - [x] Парсинг CSV и создание объектов `Wallet`.
    - [x] Декодирование приватных ключей.
    - [x] Обработка ошибок.
- [x] Реализовать метод `SignTransaction` для `Wallet`
    - [ ] Подписание транзакций приватным ключом.
    - [ ] Добавление подписей в транзакцию.
- [ ] Обеспечить безопасность хранения приватных ключей
    - [ ] Рассмотреть шифрование ключей на диске.
    - [ ] Установить строгие права доступа к файлам.

### 3.4 `internal/sniping/sniper.go`

- [x] Реализовать функцию `NewSniper`
    - [x] Инициализировать объект `Sniper` с клиентом, кошельками, конфигурацией и логгером.
- [x] Реализовать метод `Run`
    - [x] Обход списка задач.
    - [x] Запуск каждой задачи в соответствии с количеством Workers.
    - [x] Обработка сигналов завершения и ошибок.
- [x] Добавить обработку ошибок и логирование на каждом этапе

### 3.5 `internal/sniping/strategy.go`

- [x] Реализовать структуру `Task` и функцию `LoadTasks`
    - [x] Чтение файла `tasks.csv`.
    - [x] Парсинг CSV и создание объектов `Task`.
    - [x] Валидация полей и обработка ошибок.
- [ ] Реализовать метод `ExecuteTask`
    - [ ] Получение кошелька по имени из задачи.
    - [ ] Выбор стратегии в зависимости от поля `Module`.
    - [ ] Обработка неизвестных модулей с предупреждением в логах.
- [ ] Реализовать стратегии для каждого модуля
    - [ ] **Raydium**:
        - [ ] Подписка на новые пулы.
        - [ ] Фильтрация пулов по критериям задачи.
        - [ ] Подготовка и отправка транзакций.
    - [ ] **Pump.fun**:
        - [ ] Аналогично Raydium, с учетом специфики платформы.

### 3.6 `internal/eventlistener/listener.go`

- [ ] Реализовать функцию `NewEventListener`
    - [x] Установка WebSocket-соединения с использованием `gobwas/ws`.
    - [ ] Обработка ошибок подключения.
- [ ] Реализовать метод `Subscribe`
    - [x] Запуск горутины для чтения сообщений.
    - [x] Чтение и обработка сообщений из WebSocket.
    - [ ] Парсинг сообщений в структуру `Event`.
    - [ ] Вызов переданного обработчика `handler`.
- [ ] Обеспечить повторные попытки подключения при разрыве связи
    - [ ] Реализовать механизм повторного подключения с экспоненциальной задержкой.

### 3.7 `internal/eventlistener/handler.go`

- [x] Реализовать функцию `HandleEvent`
    - [ ] Фильтрация событий по заданным критериям.
    - [ ] Логирование полученных событий.
    - [ ] Передача релевантных событий в соответствующие компоненты (например, снайперу).

### 3.8 `internal/transaction/transaction.go`

- [ ] Реализовать функцию `PrepareTransaction`
    - [ ] Создание новой транзакции.
    - [ ] Добавление необходимых инструкций для обмена SOL на целевые токены.
    - [ ] Учет параметров задачи (AmountIn, MinAmountOut и т.д.).
    - [ ] Подписание транзакции с использованием кошелька.
- [ ] Реализовать функцию `SendTransaction`
    - [ ] Отправка транзакции через клиент Solana.
    - [ ] Обработка ошибок и логирование.
    - [ ] Возврат хеша транзакции.
- [x] Добавить обработку повторных попыток при неудаче отправки
    - [x] Реализовать механизм повторных попыток с учетом параметра `Retries` из конфигурации.

### 3.9 `internal/transaction/fee_manager.go`

- [x] Реализовать функцию `AdjustPriorityFee`
    - [x] Установка приоритетной комиссии для транзакции.
    - [x] Изменение соответствующих полей в транзакции.
- [ ] Добавить динамическое управление комиссиями
    - [ ] Адаптация комиссии в зависимости от загруженности сети или других факторов.

### 3.10 `internal/utils/logger.go`

- [x] Реализовать функцию `InitLogger`
    - [x] Настройка логгера в режимах Debug и Production.
    - [x] Обработка ошибок и возврат экземпляра логгера.
- [x] Обеспечить возможность логирования в файл и консоль
    - [x] Настроить вывод логов в оба места при необходимости.

### 3.11 `pkg/blockchain/solana/client.go`

- [x] Реализовать структуру `Client` и функцию `NewClient`
    - [x] Инициализация клиента с пулом RPC-конечных точек.
    - [x] Установка логгера.
- [x] Реализовать метод `SendTransaction`
    - [x] Получение доступного RPC-клиента из пула.
    - [x] Отправка транзакции и обработка ошибок.
    - [x] Логирование результатов.
- [x] Реализовать метод `GetRecentBlockhash`
    - [x] Получение последнего blockhash из сети.
    - [x] Обработка ошибок и логирование.
- [ ] Реализовать метод `SubscribeNewPools`
    - [ ] Подписка на события создания новых пулов.
    - [ ] Использование WebSocket или RPC-подписок.
    - [ ] Вызов переданного обработчика при обнаружении новых пулов.

### 3.12 `pkg/blockchain/solana/rpc_pool.go`

- [x] Реализовать структуру `RPCPool` и функцию `NewRPCPool`
    - [x] Создание списка RPC-клиентов из `rpcList`.
    - [x] Инициализация индекса и мьютекса.
- [x] Реализовать метод `GetClient`
    - [x] Возврат доступного RPC-клиента с балансировкой нагрузки.
    - [x] Обеспечение потокобезопасности с помощью мьютекса.
- [ ] Добавить проверку доступности RPC-клиентов
    - [ ] Периодически проверять работоспособность клиентов и исключать недоступные.


## 4. Тестирование компонентов

- [ ] Написать модульные тесты для каждого пакета
    - [ ] Проверка корректности функций при различных входных данных.
    - [ ] Обеспечение высокого покрытия кода тестами.
- [ ] Написать интеграционные тесты
    - [ ] Тестирование взаимодействия между компонентами (например, sniping и transaction).
    - [ ] Использование моков для внешних зависимостей.
- [ ] Написать сквозные тесты (E2E)
    - [ ] Симуляция полного цикла работы бота в тестовой сети.
    - [ ] Проверка корректности от загрузки конфигурации до выполнения транзакции.

## 5. Документация

- [ ] Обновить `README.md`
    - [ ] Добавить инструкции по установке и запуску бота.
    - [ ] Описать требования к окружению и зависимостям.
- [ ] Создать подробную документацию в `docs/`
    - [ ] Описать архитектуру проекта.
    - [ ] Предоставить инструкции по использованию и настройке.
- [ ] Добавить комментарии к коду
    - [ ] Использовать GoDoc-стиль комментариев для функций и методов.
    - [ ] Объяснить сложные участки кода.

## 6. Развертывание

- [ ] Создать `Dockerfile` для контейнеризации приложения
    - [ ] Описать процесс сборки и запуска приложения в контейнере.
- [ ] Создать `docker-compose.yml` для локального развертывания
    - [ ] Описать сервисы, необходимые для работы (например, база данных, если требуется).
- [ ] Настроить манифесты Kubernetes в `deploy/kubernetes/`
    - [ ] Описать Deployment и Service для приложения.
    - [ ] Настроить параметры масштабирования и ресурсные лимиты.

## 7. Улучшения и оптимизации

- [ ] Реализовать динамическую перезагрузку конфигурации
    - [ ] Использовать возможности `viper` для отслеживания изменений в файлах конфигурации.
- [ ] Добавить сбор и экспорт метрик
    - [ ] Реализовать метрики производительности и состояния.
    - [ ] Экспортировать метрики через Prometheus-подобный экспортёр.
- [ ] Настроить систему оповещений
    - [ ] Реализовать отправку уведомлений через вебхуки при возникновении ошибок или важных событий.
- [ ] Оптимизировать использование ресурсов
    - [ ] Провести профилирование приложения.
    - [ ] Оптимизировать горячие участки кода.

## 8. Безопасность

- [ ] Обеспечить безопасность работы с приватными ключами
    - [ ] Шифровать приватные ключи на диске.
    - [ ] Ограничить доступ к файлам ключей.
- [ ] Реализовать защиту от возможных атак
    - [ ] Внедрить валидацию входящих данных.
    - [ ] Обработать возможные сценарии отказа сервисов.
- [ ] Провести аудит безопасности кода
    - [ ] Использовать инструменты статического анализа (например, `gosec`).
    - [ ] Исправить выявленные уязвимости.

## 9. Непрерывная интеграция и развертывание (CI/CD)

- [ ] Настроить GitHub Actions или другой CI/CD инструмент
    - [ ] Автоматизировать сборку, тестирование и развертывание приложения.
- [ ] Настроить автоматический запуск тестов при пуше в репозиторий
    - [ ] Обеспечить стабильность кода и предотвращение регрессий.
- [ ] Реализовать автоматическое развертывание при успешном прохождении тестов
    - [ ] Настроить деплой в тестовое или продакшн окружение.

## 10. Финальное тестирование и отладка

- [ ] Провести нагрузочное тестирование
    - [ ] Оценить производительность приложения под высокой нагрузкой.
    - [ ] Выявить и устранить узкие места.
- [ ] Тестирование в реальных условиях
    - [ ] Запустить бота в тестовой сети Solana.
    - [ ] Проверить корректность работы всех функций.
- [ ] Сбор отзывов и корректировка
    - [ ] Собрать отзывы от пользователей или команды.
    - [ ] Внести необходимые изменения и улучшения.

## 11. Релиз и поддержка

- [ ] Подготовить релизную версию приложения
    - [ ] Обновить версию в соответствии с семантическим версионированием.
    - [ ] Составить список изменений (Changelog).
- [ ] Обеспечить поддержку и обновления
    - [ ] Отслеживать возможные ошибки и быстро реагировать на них.
    - [ ] Выпускать обновления при необходимости.

## 12. Дополнительные задачи (по мере необходимости)

- [ ] Добавить поддержку дополнительных DEX или модулей
    - [ ] Реализовать стратегии для других платформ.
- [ ] Интегрировать дополнительные функции
    - [ ] Например, прогнозирование цен, анализ рынка и т.д.
- [ ] Рассмотреть возможность масштабирования
    - [ ] Настроить приложение для работы в распределенной среде.
